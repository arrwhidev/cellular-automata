<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Cellular Automata</title>
    </head>
    <body>
        <canvas id="canvas" width="800" height="600"></canvas>
        <script>
            const ctx = document.getElementById("canvas").getContext("2d");
            const ACTIVE_COLOUR = '#525564';
            const INACTIVE_COLOUR = '#BEB9B5';
            const WIDTH = 800;
            const HEIGHT = 600;
            const SIDE = 3;
            const NUM_COLS = WIDTH / SIDE;
            const NUM_ROWS = HEIGHT / SIDE;

            // Rule 150 - http://atlas.wolfram.com/01/01/150/
            const RULES = [
                [1,1,1,1],
                [1,1,0,0],
                [1,0,1,0],
                [1,0,0,1],
                [0,1,1,0],
                [0,1,0,1],
                [0,0,1,1],
                [0,0,0,0]
            ];

            const rand = () => Math.floor(Math.random() * 2);
            const createBlock = (x, y, isActive) => ({ x, y, isActive: isActive });
            const calculateIsActive = (l, s, r) => {
                return RULES.reduce((isActive, rule) => {
                    if(l.isActive == rule[0] && s.isActive == rule[1] && r.isActive == rule[2]) {
                        isActive = rule[3];
                    }
                    return isActive;
                }, 0);
            }

            const rows = [];
            for(let row = 0; row < NUM_ROWS; row++) {
                const y = row * SIDE;
                rows.push({ cols: [] });

                for(let col = 0; col < NUM_COLS; col++) {
                    const x = col * SIDE;
                    let isActive;
                    if(row > 0) {
                        const prevRow = rows[row - 1];
                        const prevL = prevRow.cols[col - 1] || prevRow.cols[prevRow.cols.length - 1];
                        const prevSelf = prevRow.cols[col];
                        const prevR = prevRow.cols[col + 1] || prevRow.cols[0];
                        isActive = calculateIsActive(prevL, prevSelf, prevR);
                    } else {
                        isActive = rand();
                    }

                    rows[row].cols.push(createBlock(x, y, isActive));
                }
            }

            rows.forEach(row => {
                row.cols.forEach(col => {
                    ctx.fillStyle = col.isActive ? ACTIVE_COLOUR : INACTIVE_COLOUR;
                    ctx.fillRect(col.x, col.y, SIDE, SIDE);
                });
            });
        </script>
    </body>
</html>
