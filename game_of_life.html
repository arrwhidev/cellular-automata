<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Conway's Game of Life</title>
    </head>
    <body>
        <canvas id="canvas" width="800" height="600"></canvas>
        <script>
            const ctx = document.getElementById("canvas").getContext("2d");
            const ACTIVE_COLOUR = '#525564';
            const INACTIVE_COLOUR = '#BEB9B5';
            const UNIVERSE_UPDATE_TIME = 100;
            const WIDTH = 800;
            const HEIGHT = 600;
            const SIDE = 5;
            const NUM_COLS = WIDTH / SIDE;
            const NUM_ROWS = HEIGHT / SIDE;
            let universe;
            let lastTime;

            const createEmptyUniverse = () => {
                const arr = [];
                for(let y = 0; y < NUM_ROWS; y++) {
                    arr[y] = new Array(NUM_COLS);
                    for(let x = 0; x < NUM_COLS; x++) {
                        arr[y][x] = 0;
                    }
                }
                return arr;
            }

            const cellState = (y, x) => {
                if(universe[y] && universe[y][x]) return universe[y][x];
                return 0;
            }

            const getNumLiveNeighbours = (x, y) => {
                let count = 0;
                if(cellState(y-1, x-1)) count++;
                if(cellState(y-1, x)) count++;
                if(cellState(y-1, x+1)) count++;
                if(cellState(y, x-1)) count++;
                if(cellState(y, x+1)) count++;
                if(cellState(y+1, x-1)) count++;
                if(cellState(y+1, x)) count++;
                if(cellState(y+1, x+1)) count++;
                return count;
            }

            const calculateIsAlive = (x, y) => {
                const numLiveNeighbours = getNumLiveNeighbours(x, y);
                let isAlive = cellState(y, x);

                if (isAlive === 1) {
                    if (numLiveNeighbours < 2) {
                        isAlive = 0;
                    } else if (numLiveNeighbours === 2 || numLiveNeighbours === 3) {
                        isAlive = 1;
                    } else if (numLiveNeighbours > 3) {
                        isAlive = 0;
                    }
                } else {
                    if (numLiveNeighbours === 3) isAlive = 1;
                }

                return isAlive;
            }

            const updateUniverse = () => {
                const nextGeneration = createEmptyUniverse();
                for(let y = 0; y < NUM_ROWS; y++) {
                    for(let x = 0; x < NUM_COLS; x++) {
                        ctx.fillStyle = universe[y][x] ? ACTIVE_COLOUR : INACTIVE_COLOUR;
                        ctx.fillRect(x * SIDE, y * SIDE, SIDE, SIDE);
                        nextGeneration[y][x] = calculateIsAlive(x, y);
                    }
                }
                universe = nextGeneration;
            }

            const universeTick = timestamp => {
                if(!lastTime) lastTime = timestamp;
                window.requestAnimationFrame(universeTick);
                const delta = timestamp - lastTime;
                if(delta >= UNIVERSE_UPDATE_TIME) {
                    lastTime = timestamp;
                    updateUniverse();
                }
            }

            // Let's create our universe and begin...


            universe = createEmptyUniverse();
            // add

            // Blinker
            universe[5][4] = 1;
            universe[5][5] = 1;
            universe[5][6] = 1;

            window.requestAnimationFrame(universeTick);
        </script>
    </body>
</html>
