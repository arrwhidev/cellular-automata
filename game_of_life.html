<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Conway's Game of Life</title>
    </head>
    <body>
        <canvas id="canvas" width="800" height="600"></canvas>
        <script>
            const ctx = document.getElementById("canvas").getContext("2d");
            const ACTIVE_COLOUR = '#525564';
            const INACTIVE_COLOUR = '#BEB9B5';
            const UNIVERSE_UPDATE_TIME = 100;
            const WIDTH = 800;
            const HEIGHT = 600;
            const SIDE = 20;
            const NUM_COLS = 10;
            const NUM_ROWS =  10;

            // Create an empty universe!
            const universe = [];
            for(let y = 0; y < NUM_ROWS; y++) {
                universe[y] = new Array(NUM_COLS);
                for(let x = 0; x < NUM_COLS; x++) {
                    universe[y][x] = 0;
                }
            }

            // Blinker
            universe[5][4] = 1;
            universe[5][5] = 1;
            universe[5][6] = 1;

            const cellIsAlive = (y, x) => {
                if(universe[y] !== undefined && universe[y][x] !== undefined) {
                    return universe[y][x];
                }
                return 0;
            }

            const getNumLiveNeighbours = (x, y) => {
                let count = 0;
                if(cellIsAlive(y-1, x-1)) count++;
                if(cellIsAlive(y-1, x)) count++;
                if(cellIsAlive(y-1, x+1)) count++;
                if(cellIsAlive(y, x-1)) count++;
                if(cellIsAlive(y, x+1)) count++;
                if(cellIsAlive(y+1, x-1)) count++;
                if(cellIsAlive(y+1, x)) count++;
                if(cellIsAlive(y+1, x+1)) count++;
                return count;
            }

            const calculateIsAlive = (x, y) => {
                const numLiveNeighbours = getNumLiveNeighbours(x, y);
                let isAlive = cellIsAlive(y, x);
                // console.log(y, x, 'numLiveNeighbours:', numLiveNeighbours, 'isAlive:', isAlive);

                if (isAlive === 1) {
                    if (numLiveNeighbours < 2) {
                        isAlive = 0;
                    } else if (numLiveNeighbours === 2 || numLiveNeighbours === 3) {
                        isAlive = 1;
                    } else if (numLiveNeighbours > 3) {
                        isAlive = 0;
                    }
                } else {
                    if (numLiveNeighbours === 3) isAlive = 1;
                }

                // console.log('  --> returning', isAlive);
                return isAlive;
            }

            const updateUniverse = () => {
                for(let y = 0; y < NUM_ROWS; y++) {
                    for(let x = 0; x < NUM_COLS; x++) {
                        universe[y][x] = calculateIsAlive(x, y);
                    }
                }
            };
            const drawUniverse = () => {
                for(let y = 0; y < NUM_ROWS; y++) {
                    for(let x = 0; x < NUM_COLS; x++) {
                        ctx.fillStyle = universe[y][x] ? ACTIVE_COLOUR : INACTIVE_COLOUR;
                        ctx.fillRect(x * SIDE, y * SIDE, SIDE, SIDE);
                    }
                }
            }

            let lastTime;
            // let numRenders = 0;
            const universeTick = timestamp => {
                if(!lastTime) lastTime = timestamp;
                window.requestAnimationFrame(universeTick);
                const delta = timestamp - lastTime;
                if(delta >= UNIVERSE_UPDATE_TIME) {
                    lastTime = timestamp;
                    updateUniverse();
                    drawUniverse();
                }
            };
            window.requestAnimationFrame(universeTick);
        </script>
    </body>
</html>
